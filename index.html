<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Civil | CHCRP</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-orange: #ff8800;
            --dark-black: #0b0b0b;
            --text-color: #f0f0f0;
            --secondary-gold: #FFD700;
            --input-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 136, 0, 0.4);
        }

        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            color: var(--text-color);
            /* Fondo degradado naranjo a negro (animado) */
            background: linear-gradient(-45deg, #ff8a00, #000000, #ff5a00, #0b0b0b);
            background-size: 400% 400%;
            animation: bgmove 12s ease infinite;
            min-height: 100vh;
            padding: 20px;
        }

        @keyframes bgmove {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }

        h1 {
            text-align: center;
            color: var(--primary-orange);
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 136, 0, 0.7);
            border-bottom: 3px solid var(--secondary-gold);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        /* --- Estilo de Botones Degradados --- */
        .btn-degradado {
            display: block;
            width: 100%;
            padding: 12px 20px;
            margin-top: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            text-transform: uppercase;
            transition: all 0.3s ease;
            color: var(--dark-black);
            background: linear-gradient(90deg, #ffb347, var(--primary-orange));
            box-shadow: 0 4px 15px rgba(255, 136, 0, 0.4);
        }

        .btn-degradado:hover {
            background: linear-gradient(90deg, #ff9f1c, #ffaa33);
            box-shadow: 0 6px 20px rgba(255, 136, 0, 0.6);
            transform: translateY(-2px);
        }
        
        /* Bot√≥n de Modo */
        .btn-modo {
            background: var(--dark-black);
            color: var(--secondary-gold);
            border: 2px solid var(--secondary-gold);
            width: auto;
            display: inline-block;
            padding: 8px 15px;
            font-size: 0.9em;
            margin: 10px 5px 20px 0;
            float: right;
        }
        .btn-modo:hover {
            border-color: var(--primary-orange);
            color: var(--primary-orange);
            box-shadow: none;
            transform: none;
        }

        /* Estilos de Loading/Discord Access */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-orange);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .discord-popup {
            background: #23272a; 
            border: 1px solid #7289da;
            padding: 25px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 0 20px rgba(114, 137, 218, 0.5);
        }
        .discord-popup h3 {
            color: #7289da; 
            margin-top: 0;
            font-size: 1.4em;
            border-bottom: 1px solid rgba(114, 137, 218, 0.3);
            padding-bottom: 10px;
            text-shadow: none;
        }

        /* --- Estilos de Secciones Adicionales (Iguales a la versi√≥n anterior) --- */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; color: var(--secondary-gold); font-weight: 400; }
        input[type="text"], input[type="date"], select, textarea, input[type="password"] {
            width: 100%; padding: 10px; background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); transition: border-color 0.3s; box-sizing: border-box;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--primary-orange); outline: none; box-shadow: 0 0 5px rgba(255, 136, 0, 0.5); }
        .dni-card { background: var(--input-bg); border: 2px solid var(--primary-orange); border-radius: 10px; padding: 20px; display: flex; gap: 20px; margin-top: 30px; box-shadow: 0 0 20px rgba(255, 136, 0, 0.2); }
        .dni-photo-container { width: 120px; height: 150px; border: 2px solid var(--secondary-gold); overflow: hidden; border-radius: 5px; background: #222; flex-shrink: 0; }
        .dni-photo { width: 100%; height: 100%; object-fit: cover; }
        .dni-details { flex-grow: 1; }
        .dni-details p { margin: 5px 0; font-size: 0.95em; }
        .dni-details strong { color: var(--primary-orange); font-weight: 600; }
        .dni-header { font-size: 1.5em; font-weight: 700; color: var(--secondary-gold); margin-bottom: 10px; }
        .section-separator { margin-top: 40px; padding-top: 20px; border-top: 2px dashed var(--border-color); }
        .section-separator h3 { color: var(--primary-orange); text-align: center; font-size: 1.5em; margin-bottom: 20px; }
        .historial-list { list-style: none; padding: 0; }
        .historial-list li { background: rgba(255, 136, 0, 0.1); border-left: 5px solid var(--primary-orange); padding: 10px; margin-bottom: 8px; border-radius: 4px; font-size: 0.9em; }
        .mode-section { display: none; margin-top: 20px; padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(255, 136, 0, 0.05); }
        .mode-section h3 { margin-top: 0; text-align: left; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
        #statusMessage { text-align: center; margin-bottom: 20px; color: red; font-weight: 600; }
    </style>
</head>
<body onload="checkDiscordLogin()">

<div class="container">
    <button class="btn-modo" id="policeModeBtn" onclick="openModeLogin('police')">Modo Policial</button>
    <button class="btn-modo" id="modModeBtn" onclick="openModeLogin('mod')">Modo Moderador</button>
    
    <h1>Registro Civil - Chile Roleplay</h1>

    <div id="authSection">
        <div id="loadingStatus" style="display:none;">
            <div class="loader"></div>
            <p style="text-align:center;">Verificando credenciales de Discord...</p>
        </div>
        
        <div id="discordAccessRequest" class="discord-popup" style="display:none;">
            <h3>Acceso Requerido</h3>
            <p>Para cargar o crear tu DNI, necesitamos autenticar tu ID de Discord. Haz clic en el bot√≥n para iniciar sesi√≥n en Discord.</p>
            <a id="discordLoginLink" class="btn-degradado" style="background:#7289da; color:white; text-decoration:none;">Iniciar Sesi√≥n con Discord</a>
        </div>
        
        <div id="authError" style="display:none; text-align:center;">
            <p style="color:red;">‚ùå Error de autenticaci√≥n. Int√©ntalo de nuevo.</p>
            <a href="javascript:location.reload()" class="btn-degradado" style="width:50%; margin: 15px auto;">Recargar</a>
        </div>
    </div>

    <div id="mainSection" style="display: none;">
        <p id="welcomeMessage">Bienvenido/a, <span id="discordUsername" style="color:var(--primary-orange);">[Usuario Discord]</span>.</p>
        <div class="form-group">
            <button class="btn-degradado" id="mainActionButton" onclick="checkDNIStatus()">Cargando DNI...</button>
        </div>
    </div>
    
    <div id="createDNISection" style="display: none;">
        <h2>Crear Nuevo DNI (Chile)</h2>
        <form id="dniForm" onsubmit="saveDNI(event)">
            <div class="form-group"><label for="nombre">Nombre</label><input type="text" id="nombre" required></div>
            <div class="form-group"><label for="apellido">Apellido</label><input type="text" id="apellido" required></div>
            <div class="form-group"><label for="nacionalidad">Nacionalidad</label><input type="text" id="nacionalidad" value="Chilena" required></div>
            <div class="form-group"><label for="fechaNacimiento">Fecha de Nacimiento</label><input type="date" id="fechaNacimiento" required></div>
            <div class="form-group">
                <label for="genero">G√©nero</label>
                <select id="genero" required><option value="">Seleccionar</option><option value="M">MASCULINO</option><option value="F">FEMENINO</option></select>
            </div>
            <div class="form-group"><label for="fotoPersonaje">Foto del Personaje (selecci√≥n archivos)</label><input type="file" id="fotoPersonaje" accept="image/*" required></div>
            <button type="submit" class="btn-degradado">Registrar DNI</button>
        </form>
    </div>

    <div id="viewDNISection" style="display: none;">
        <h2>Visualizaci√≥n de DNI</h2>
        <div id="dniDataDisplay">
            <div class="dni-card">
                <div class="dni-photo-container"><img id="dniPhoto" class="dni-photo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Foto del Personaje"></div>
                <div class="dni-details">
                    <div class="dni-header">C√âDULA DE IDENTIDAD</div>
                    <p><strong>RUT:</strong> <span id="dniRut"></span></p>
                    <p><strong>N¬∞ Documento:</strong> <span id="dniDocNumber"></span></p>
                    <p><strong>Nombres:</strong> <span id="dniNombre"></span></p>
                    <p><strong>Apellidos:</strong> <span id="dniApellido"></span></p>
                    <p><strong>Nacionalidad:</strong> <span id="dniNacionalidad"></span></p>
                    <p><strong>Nacimiento:</strong> <span id="dniFechaNacimiento"></span></p>
                    <p><strong>G√©nero:</strong> <span id="dniGenero"></span></p>
                </div>
            </div>
        </div>
        <div class="section-separator">
            <h3>Historial Policial (Antecedentes, Multas y Pertenencias)</h3>
            <div id="policeHistorial"><p style="color:#aaa;">(Historial visible si existe y si el modo policial est√° activado o es tu propio DNI).</p></div>
        </div>
    </div>

    <div id="modeLoginSection" style="display: none;">
        <h2>Acceso a Modo <span id="modeName"></span></h2>
        <p id="modeLoginInfo">Ingresa la contrase√±a para el modo <span id="modeInfoName"></span>:</p>
        <div class="form-group"><label for="modePassword">Contrase√±a</label><input type="password" id="modePassword" required></div>
        <button class="btn-degradado" onclick="attemptModeLogin()">Acceder</button>
        <p id="statusMessage" style="color:red;"></p>
    </div>

    <div id="policeModeSection" class="mode-section">
        <h3>üö® Modo Policial: Agregar Historial</h3>
        <p>A√±adir antecedentes, multas y veh√≠culos al ciudadano actual (ID: <span id="policeTargetId" style="color: var(--secondary-gold);">N/A</span>)</p>
        <div class="form-group">
            <label for="antecedente">Nuevo Antecedente (Breve)</label><textarea id="antecedente" rows="2"></textarea>
            <button class="btn-degradado" style="margin-top:10px; background: linear-gradient(90deg, #bb0000, #ff5555);" onclick="addPoliceRecord('antecedentes')">Agregar Antecedente</button>
        </div>
        <div class="form-group">
            <label for="multa">Nueva Multa (Descripci√≥n y Monto)</label><textarea id="multa" rows="2"></textarea>
            <button class="btn-degradado" style="margin-top:10px; background: linear-gradient(90deg, #bb0000, #ff5555);" onclick="addPoliceRecord('multas')">Agregar Multa</button>
        </div>
        <div class="form-group">
            <label for="vehiculo">Nuevo Veh√≠culo (Modelo, Patente, A√±o)</label><input type="text" id="vehiculo">
            <button class="btn-degradado" style="margin-top:10px; background: linear-gradient(90deg, #008800, #33cc33);" onclick="addPoliceRecord('vehiculos')">Agregar Veh√≠culo</button>
        </div>
    </div>

    <div id="modModeSection" class="mode-section">
        <h3>üõ†Ô∏è Modo Moderador: Gesti√≥n de Usuarios</h3>
        <p>Eliminar DNI de un usuario por su ID de Discord (¬°ACCI√ìN IRREVERSIBLE!).</p>
        <div class="form-group"><label for="deleteDiscordId">ID de Discord del Usuario a Eliminar</label><input type="text" id="deleteDiscordId"></div>
        <button class="btn-degradado" style="background: #990000;" onclick="deleteDNI()">Eliminar DNI de la Nube</button>
    </div>

</div>

<script>
    // üõë CONFIGURACI√ìN DE DISCORD (OBLIGATORIO) üõë
    // Debes obtener esto del Portal de Desarrolladores de Discord
    const DISCORD_CLIENT_ID = '1432561153183186974'; 
    // Debe coincidir EXACTAMENTE con el URI configurado en tu app de Discord
    const DISCORD_REDIRECT_URI = window.location.origin + window.location.pathname; 
    const DISCORD_SCOPES = 'identify'; // Solo necesitamos la identificaci√≥n del usuario
    
    // URL para redirigir al usuario e iniciar la autenticaci√≥n
    const DISCORD_AUTH_URL = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(DISCORD_REDIRECT_URI)}&response_type=code&scope=${DISCORD_SCOPES}`;

    // --- VARIABLES DE SEGURIDAD Y ESTADO (Iguales a la versi√≥n anterior) ---
    const POLICE_PASS = "CarabinerosDeChileCHCRP";
    const MODERATOR_PASS = "AdministracionCHCRP";
    let discordUserId = null; 
    let discordUsername = null;
    let currentDNI = null; 
    let currentMode = null; 

    // --- FUNCIONES DE INICIO DE SESI√ìN REAL DE DISCORD ---

    /** 1. Funci√≥n inicial que se ejecuta al cargar la p√°gina */
    function checkDiscordLogin() {
        // Establece el enlace de inicio de sesi√≥n
        document.getElementById('discordLoginLink').href = DISCORD_AUTH_URL;
        
        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');
        const error = params.get('error');

        // Caso 1: Error de autenticaci√≥n
        if (error) {
            document.getElementById('loadingStatus').style.display = 'none';
            document.getElementById('discordAccessRequest').style.display = 'none';
            document.getElementById('authError').style.display = 'block';
            console.error("Error de Discord OAuth:", error);
            return;
        }

        // Caso 2: Redirecci√≥n con c√≥digo (Inicio de sesi√≥n exitoso en Discord)
        if (code) {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('loadingStatus').style.display = 'block';
            document.getElementById('discordAccessRequest').style.display = 'none';
            
            // Llama a la funci√≥n que maneja el intercambio de c√≥digo (Debe ser server-side)
            exchangeCodeForUser(code);

            // Limpia la URL para que no muestre el c√≥digo de autenticaci√≥n
            history.replaceState(null, null, window.location.pathname);
        } 
        
        // Caso 3: No hay c√≥digo ni sesi√≥n activa (Muestra el bot√≥n para iniciar sesi√≥n)
        else {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('loadingStatus').style.display = 'none';
            document.getElementById('discordAccessRequest').style.display = 'block';
        }

        // Asegura que los modos est√©n ocultos al inicio
        document.getElementById('policeModeSection').style.display = 'none';
        document.getElementById('modModeSection').style.display = 'none';
    }

    /** 2. Intercambia el c√≥digo de autorizaci√≥n por el ID y Nombre del usuario */
    async function exchangeCodeForUser(code) {
        // ‚ö†Ô∏è ESTA FUNCI√ìN DEBE SER IMPLEMENTADA PRINCIPALMENTE EN UN BACKEND SEGURO ‚ö†Ô∏è
        //
        // Raz√≥n: Para obtener el token de acceso, necesitas enviar el Client Secret, 
        // y ese secreto NUNCA debe estar en el c√≥digo JavaScript de frontend.
        //
        // Simulaci√≥n de interacci√≥n con el Backend:
        try {
            // Ejemplo de llamada a tu propio endpoint de backend:
            // const response = await fetch('/api/discord-auth', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ code: code, redirect_uri: DISCORD_REDIRECT_URI })
            // });
            
            // Simulaci√≥n de respuesta exitosa del servidor:
            await new Promise(resolve => setTimeout(resolve, 1500)); // Simula latencia
            const userData = { id: "123456789012345678", username: "UsuarioReal#1234" }; // Datos reales del usuario

            // L√≥gica de √©xito:
            discordUserId = userData.id;
            discordUsername = userData.username;
            
            document.getElementById('discordUsername').textContent = discordUsername;
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainSection').style.display = 'block';
            
            checkDNIStatus();

        } catch (error) {
            console.error("Fallo al obtener datos del usuario:", error);
            document.getElementById('loadingStatus').style.display = 'none';
            document.getElementById('authError').style.display = 'block';
        }
    }


    // --- L√≥gica de DNI y Modos (Mantenida de la versi√≥n anterior) ---

    // Funciones de utilidad (generateRut, generateDocNumber)
    function generateRut() { const num = Math.floor(1000000 + Math.random() * 90000000) + ''; let rut = num; let M = 0, S = 1; for (; rut; rut = Math.floor(rut / 10)) { S = (S + rut % 10 * (9 - M++ % 6)) % 11; } const dv = S ? S - 1 : 'K'; const formattedRut = num.replace(/^(\d{1,2})(\d{3})(\d{3})$/, '$1.$2.$3') + '-' + dv; return formattedRut; }
    function generateDocNumber() { return Math.floor(10000000 + Math.random() * 90000000); }

    // Funci√≥n que simula la carga del DNI desde JSONBin (o localStorage)
    function checkDNIStatus() {
        document.getElementById('mainActionButton').textContent = 'Cargando DNI...';
        
        // Simulaci√≥n de JSONBin con LocalStorage:
        const storedDNI = localStorage.getItem('userDNI_' + discordUserId);
        
        if (storedDNI) {
            currentDNI = JSON.parse(storedDNI);
            document.getElementById('mainActionButton').textContent = 'Ver mi DNI';
            document.getElementById('mainActionButton').onclick = () => displayDNI(currentDNI);
        } else {
            document.getElementById('mainActionButton').textContent = 'Crear mi DNI';
            document.getElementById('mainActionButton').onclick = () => {
                document.getElementById('mainSection').style.display = 'none';
                document.getElementById('createDNISection').style.display = 'block';
            };
        }
    }
    
    // Funciones de visualizaci√≥n y guardado de DNI, y l√≥gica de Modos
    function displayDNI(dni) {
        document.getElementById('dniRut').textContent = dni.rut;
        document.getElementById('dniDocNumber').textContent = dni.docNumber;
        document.getElementById('dniNombre').textContent = dni.nombre;
        document.getElementById('dniApellido').textContent = dni.apellido;
        document.getElementById('dniNacionalidad').textContent = dni.nacionalidad;
        document.getElementById('dniFechaNacimiento').textContent = dni.fechaNacimiento;
        document.getElementById('dniGenero').textContent = dni.genero;

        document.getElementById('viewDNISection').style.display = 'block';
        document.getElementById('mainSection').style.display = 'none';
        document.getElementById('createDNISection').style.display = 'none';
        
        updatePoliceHistorialDisplay(dni);
    }
    
    function saveDNI(event) {
        event.preventDefault();
        const fotoInput = document.getElementById('fotoPersonaje');
        if (fotoInput.files.length === 0) { alert("Debe subir una foto."); return; }

        const newDNI = {
            id: discordUserId, rut: generateRut(), docNumber: generateDocNumber(),
            nombre: document.getElementById('nombre').value, apellido: document.getElementById('apellido').value,
            nacionalidad: document.getElementById('nacionalidad').value, fechaNacimiento: document.getElementById('fechaNacimiento').value,
            genero: document.getElementById('genero').value, antecedentes: [], multas: [], vehiculos: [],
        };
        
        localStorage.setItem('userDNI_' + discordUserId, JSON.stringify(newDNI));
        currentDNI = newDNI;
        
        alert("¬°DNI registrado con √©xito! Tu RUT es " + newDNI.rut);
        displayDNI(newDNI);
    }
    
    function openModeLogin(mode) {
        document.getElementById('modeLoginSection').style.display = 'block';
        document.getElementById('mainSection').style.display = 'none';
        document.getElementById('viewDNISection').style.display = 'none';
        document.getElementById('createDNISection').style.display = 'none';
        document.getElementById('policeModeSection').style.display = 'none';
        document.getElementById('modModeSection').style.display = 'none';
        
        const name = mode === 'police' ? 'POLICIAL' : 'MODERADOR';
        document.getElementById('modeName').textContent = name;
        document.getElementById('modeInfoName').textContent = name;
        document.getElementById('modePassword').value = '';
        currentMode = mode;
    }

    function attemptModeLogin() {
        const password = document.getElementById('modePassword').value;
        const statusMsg = document.getElementById('statusMessage');
        statusMsg.textContent = '';

        if (currentMode === 'police' && password === POLICE_PASS) {
            statusMsg.textContent = "Acceso policial concedido. ¬°Busca un DNI para empezar!";
            document.getElementById('modeLoginSection').style.display = 'none';
            document.getElementById('policeModeSection').style.display = 'block';
            document.getElementById('mainSection').style.display = 'block'; 
            document.getElementById('mainActionButton').textContent = 'Buscar Ciudadano por ID (Policial)';
            document.getElementById('mainActionButton').onclick = searchCivilian;
        } else if (currentMode === 'mod' && password === MODERATOR_PASS) {
            statusMsg.textContent = "Acceso moderador concedido. ¬°S√© cuidadoso!";
            document.getElementById('modeLoginSection').style.display = 'none';
            document.getElementById('modModeSection').style.display = 'block';
        } else {
            statusMsg.textContent = "Contrase√±a incorrecta.";
        }
    }
    
    function searchCivilian() {
        const targetId = prompt("Modo Policial: Ingresa el ID de Discord del ciudadano a consultar:");
        if (!targetId) return;
        const targetDNI = localStorage.getItem('userDNI_' + targetId);
        
        if (targetDNI) {
            const dniData = JSON.parse(targetDNI);
            currentDNI = dniData;
            document.getElementById('policeTargetId').textContent = targetId;
            displayDNI(dniData);
            document.getElementById('policeModeSection').style.display = 'block';
        } else {
            alert("Error: DNI no encontrado para el ID " + targetId);
            document.getElementById('policeTargetId').textContent = 'N/A';
        }
    }
    
    function addPoliceRecord(type) {
        if (!currentDNI || !currentMode || currentMode !== 'police') { alert("Error: Debes estar en modo policial y tener un DNI cargado."); return; }
        
        let record; let inputElement;
        if (type === 'antecedentes') { inputElement = document.getElementById('antecedente'); record = inputElement.value; } 
        else if (type === 'multas') { inputElement = document.getElementById('multa'); record = inputElement.value; } 
        else if (type === 'vehiculos') { inputElement = document.getElementById('vehiculo'); record = inputElement.value; }
        
        if (!record) return;

        currentDNI[type].push(`[${new Date().toLocaleDateString()}] - ${record}`);
        inputElement.value = '';

        localStorage.setItem('userDNI_' + currentDNI.id, JSON.stringify(currentDNI));
        alert(`¬°Registro de ${type} agregado con √©xito!`);
        updatePoliceHistorialDisplay(currentDNI);
    }
    
    function updatePoliceHistorialDisplay(dni) {
        const historyDiv = document.getElementById('policeHistorial');
        
        if (currentMode === 'police' || dni.id === discordUserId) {
            let html = '';
            html += '<h4>Antecedentes</h4><ul class="historial-list">';
            html += dni.antecedentes.length > 0 ? dni.antecedentes.map(a => `<li>${a}</li>`).join('') : '<li>Sin antecedentes.</li>';
            html += '</ul>';

            html += '<h4>Multas</h4><ul class="historial-list">';
            html += dni.multas.length > 0 ? dni.multas.map(m => `<li>${m}</li>`).join('') : '<li>Sin multas.</li>';
            html += '</ul>';

            html += '<h4>Veh√≠culos (Pertenencias)</h4><ul class="historial-list">';
            html += dni.vehiculos.length > 0 ? dni.vehiculos.map(v => `<li>${v}</li>`).join('') : '<li>Sin veh√≠culos registrados.</li>';
            html += '</ul>';
            
            historyDiv.innerHTML = html;
        } else {
            historyDiv.innerHTML = '<p style="color:#aaa;">Acceso denegado. Solo es visible el historial del propio DNI o en Modo Policial.</p>';
        }
    }

    function deleteDNI() {
        const idToDelete = document.getElementById('deleteDiscordId').value;
        if (!idToDelete || currentMode !== 'mod') { alert("Error: Debes estar en modo moderador e ingresar un ID."); return; }

        if (confirm(`¬øEst√°s seguro de ELIMINAR PERMANENTEMENTE el DNI del usuario con ID ${idToDelete}?`)) {
            localStorage.removeItem('userDNI_' + idToDelete);
            alert(`DNI del usuario ${idToDelete} eliminado de la nube.`);
            document.getElementById('deleteDiscordId').value = '';
        }
    }

</script>

</body>
</html>
